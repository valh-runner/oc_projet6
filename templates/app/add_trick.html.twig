{% extends 'base.html.twig' %}

{% form_theme formTrick 'bootstrap_4_layout.html.twig' %}

{% macro printPicturePrototype(picture, placeHolder, isRequired) %}
    <li>
    	<div class="form-row">
	    	<div class="form-group col-3">
	    		<div class="img-preview-holder">
	            {% if picture.vars.value.filename is defined %}
	    			<img class="img-preview" src="{{ asset('uploads/img/' ~ picture.vars.value.filename) }}" alt="{{ picture.vars.value.filename }}">
	            {% endif %}
	        	</div>
	    	</div>
	    	<div class="form-group col">
	    		{{ form_widget(picture.file, {
					'attr': {
						'placeholder': placeHolder,
					},
					'required': isRequired,
				}) }}
	    	</div>
	    	<div class="form-group col-auto">
	    		<button type="button" class="btn btn-secondary">Supprimer</button>
	    	</div>
    	</div>
	</li>
{% endmacro %}
{% macro printVideoPrototype(video) %}
    <li>
    	<div class="form-row">
	    	<div class="form-group col-3">
		        {% if video.vars.value.embedLink is defined %}
		    		<div class="video-container">
			    			<iframe width="" height="" src="{{ video.vars.value.embedLink }}" frameborder="0" allow="accelerometer; fullscreen; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		        	</div>
		        {% endif %}
	    	</div>
	    	<div class="form-group col">
	    		{{ form_widget(video.embedLink, {
					'attr': {'placeholder': "Saisir le \"lien embed\" d'une video en ligne"},
				}) }}
	    	</div>
	    	<div class="form-group col-auto">
	    		<button type="button" class="btn btn-secondary">Supprimer</button>
	    	</div>
    	</div>
    </li>
{% endmacro %}
{% import _self as formMacros %}

{% block fullbanner %}
	<div class="fixed faded" id="fullbanner"></div>
{% endblock %}

{% block title %}{{ pageTitle }}{% endblock %}

{% block body %}
	<div class="row">
		<div class="col-sm-12 offset-md-1 col-md-10" id="content">
			<div class="row">
				<div class="container-fluid" id="second-container">
					<div class="row" id="trick-head">
						<img class="" id="trick-head-banner" src="
						{{ 
						trick is defined ?
							trick.pictures|length > 0 ? 
								trick.pictures.first.filename starts with 'http://' ? 
								trick.pictures.first.filename 
								: asset('uploads/img/' ~ trick.pictures.first.filename) 
							: asset('images/banner.jpg') 
						: asset('images/banner.jpg') 
						}}
						" alt="">
						<div class="" id="trick-head-title"><h1>{{ trick is defined ? trick.name : pageTitle }}</h1></div>
					</div>
					<div class="">
						{{ form_start(formTrick) }}

						<h5>Images</h5>
						<ul class="pictures" data-prototype="{{ formMacros.printPicturePrototype(formTrick.pictures.vars.prototype, 'Sélectionner un fichier image', true)|e('html_attr') }}">
					        {# iterate over each existing picture and render the field filename #}
					        {% for picture in formTrick.pictures %}
					        	{{ formMacros.printPicturePrototype(picture, picture.vars.value.filename, false) }}
					        {% endfor %}
						</ul>

						<h5>Videos</h5>
						<ul class="videos" data-prototype="{{ formMacros.printVideoPrototype(formTrick.videos.vars.prototype)|e('html_attr') }}">
					        {# iterate over each existing video and render the field embedLink #}
					        {% for video in formTrick.videos %}
					            {{ formMacros.printVideoPrototype(video) }}
					        {% endfor %}
						</ul>
						{#{ form_row(formTrick.featuredPicture, {
							'attr': {'placeholder': 'Sélectionner un fichier image'}, 
							'label' : 'Image à la une'
						}) }#}
						{{ form_row(formTrick.name, {
							'attr': {'placeholder': "Nom du trick"}, 
							'label' : 'Nom'
						}) }}
						{{ form_row(formTrick.description, {
								'attr': {'placeholder': "Description du trick"}, 
								'label' : 'Description'
						}) }}
						<p>Selectionnez une catégorie ou en préciser une nouvelle</p>
						{{ form_row(formTrick.categoryType, {'label' : 'Type de catégorie'}) }}
						{{ form_row(formTrick.existantCategory, {'label' : 'Catégorie existante'}) }}
						{{ form_row(formTrick.newCategory, {
							'label' : 'Nouvelle catégorie', 
							'attr': {'placeholder': "Entrez un nom"}
						}) }}
						<div class="form-group text-right mt-5">
							{% if editMode %}
								<button type="" class="btn btn-danger">Supprimer</button>
							{% endif %}
							<button type="submit" class="btn btn-primary">{{ editMode ? 'Enregistrer les modifications' : 'Créer le trick' }}</button>
						</div>

						{{ form_end(formTrick) }}
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript" src="{{ asset('js/add_trick.js') }}"></script>
{% endblock %}